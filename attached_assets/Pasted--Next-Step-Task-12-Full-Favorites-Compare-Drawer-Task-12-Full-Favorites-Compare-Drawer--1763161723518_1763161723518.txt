üèóÔ∏è Next Step: Task #12 (Full Favorites + Compare Drawer)
Task #12: Full Favorites + Compare Drawer (Final Build)

This is the task that brings everything together. The goal is to build the user interface (UI) component that displays the saved cities from Task #7 side-by-side, allowing users to compare the key metrics (like the Senior Score, Budget, etc.) instantly.

Implementation Plan: The Compare Drawer Component
We will create a full-screen or fixed-position drawer component that appears when the user has saved at least one city. This component will be driven by the useFavorites hook.

Step 1: Create the Drawer Component (client/src/components/CompareDrawer.tsx)
This component will be the master view for comparison. It needs to read the list of favorites and display placeholders for city data.

TypeScript

// client/src/components/CompareDrawer.tsx (NEW FILE)
import { X, Heart, ChevronRight, Scale } from 'lucide-react';
import { useFavorites } from '@/hooks/useFavorites'; // Use the hook from Task #7
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';

// --- Placeholder Data/Metadata (You would typically fetch this from a central API) ---
// Since we don't have a central API for city metrics, we will use a simple map.
const CITY_METRICS: Record<string, any> = {
    pv: {
        name: "Puerto Vallarta",
        rent: "High ($1200+)",
        walkability: 9,
        safety: "Moderate",
        seniorScore: 88,
        vibe: "Vibrant Beach",
    },
    merida: {
        name: "M√©rida",
        rent: "Low ($600-$900)",
        walkability: 7,
        safety: "High",
        seniorScore: 92,
        vibe: "Historic Colonial",
    },
    sma: {
        name: "San Miguel de Allende",
        rent: "High ($1000+)",
        walkability: 8,
        safety: "Moderate-High",
        seniorScore: 85,
        vibe: "Artistic & Cultural",
    },
    cancun: {
        name: "Canc√∫n",
        rent: "Varied ($800+)",
        walkability: 5,
        safety: "Varied/Tourist",
        seniorScore: 75,
        vibe: "Tropical Resort",
    },
};
// ---------------------------------------------------------------------------------


interface CompareDrawerProps {
    isOpen: boolean;
    onClose: () => void;
}

export default function CompareDrawer({ isOpen, onClose }: CompareDrawerProps) {
    const { favorites, toggleFavorite } = useFavorites();

    if (!isOpen || favorites.length === 0) return null;

    const favoriteCities = favorites.map(id => ({ 
        id, 
        ...CITY_METRICS[id] 
    }));

    // Generate a list of all metrics to display (Rent, Walkability, Safety, etc.)
    const metricsKeys = Object.keys(favoriteCities[0] || {}).filter(key => key !== 'name' && key !== 'id');

    return (
        <div 
            className="fixed inset-0 z-[100] bg-background/95 backdrop-blur-sm transition-opacity duration-300 flex flex-col p-6"
            data-testid="compare-drawer"
        >
            <div className="flex justify-between items-center mb-6 border-b border-border/50 pb-4">
                <h2 className="text-3xl font-extrabold flex items-center gap-2 text-primary">
                    <Scale className="w-6 h-6" />
                    Compare {favorites.length} Saved Cities
                </h2>
                <Button variant="ghost" size="icon" onClick={onClose} data-testid="button-close-drawer">
                    <X className="w-6 h-6" />
                </Button>
            </div>

            {/* Comparison Grid */}
            <div className="flex-1 overflow-y-auto">
                <div className="grid gap-4" style={{ gridTemplateColumns: `repeat(${favorites.length + 1}, minmax(0, 1fr))` }}>
                    
                    {/* Column 1: Metrics Header */}
                    <Card className="p-4 bg-muted/20 sticky top-0 h-full">
                        <h3 className="text-lg font-bold mb-4">Metric</h3>
                        <div className="space-y-4">
                            {metricsKeys.map(key => (
                                <div key={key} className="h-12 flex items-center font-semibold text-foreground/80 capitalize">
                                    {key.replace(/([A-Z])/g, ' $1')}
                                </div>
                            ))}
                        </div>
                    </Card>

                    {/* City Columns */}
                    {favoriteCities.map((city) => (
                        <Card key={city.id} className="p-4 relative flex flex-col">
                            {/* City Header */}
                            <div className="mb-4">
                                <h3 className="text-xl font-extrabold text-primary">{city.name}</h3>
                                <div className="flex items-center gap-2 mt-1">
                                    <Button variant="outline" size="sm" onClick={() => toggleFavorite(city.id)} data-testid={`remove-favorite-${city.id}`}>
                                        <Heart className="w-4 h-4 fill-red-500 mr-1" /> Remove
                                    </Button>
                                    <Button variant="link" size="sm" asChild>
                                        <a href={`/neighborhood/${city.id}`} className="text-blue-400">
                                            View Details <ChevronRight className="w-3 h-3 ml-1" />
                                        </a>
                                    </Button>
                                </div>
                            </div>
                            
                            {/* Data Points */}
                            <div className="space-y-4 flex-1">
                                {metricsKeys.map(key => (
                                    <div key={key} className="h-12 flex items-center text-lg font-bold">
                                        {city[key]}
                                    </div>
                                ))}
                            </div>
                        </Card>
                    ))}

                </div>
            </div>
            
            <div className="mt-6 p-4 border-t border-border/50 text-center">
                <p className="text-sm text-muted-foreground">Tip: Add up to 3 cities to your favorites (using the heart icon) to compare them here.</p>
            </div>
        </div>
    );
}
Step 2: Implement the Toggle/Button (client/src/pages/Home.tsx and client/src/pages/Neighborhood.tsx)
We need a central state in a parent component (likely your main App.tsx or a wrapper) to manage the drawer's open/close status, but for simplicity, we will implement it in the Home page and create a fixed button.

Step 2A: Integrate into Home Page (client/src/pages/Home.tsx)
This is where the state and the fixed button live.

TypeScript

// client/src/pages/Home.tsx (Updates)

// Imports
// ... existing imports
import CompareDrawer from '../components/CompareDrawer'; // ADD THIS IMPORT
import { useFavorites } from '../hooks/useFavorites'; // Re-add this import for the count
import { Heart } from 'lucide-react'; 

export default function Home() {
    // ... existing state (searchQuery, citySentiments, recommendation) ...
    const [isDrawerOpen, setIsDrawerOpen] = useState(false); // NEW STATE for drawer
    const { favorites } = useFavorites(); // USE THE HOOK for count

    // ... existing handlers and effects ...

    return (
        <div className="container py-12">
            
            {/* ... Recommendation Form & Result Section ... */}
            
            {/* ... Featured Neighborhoods Section ... */}
            
            {/* Task #12: Fixed Compare Button */}
            {favorites.length > 0 && (
                <Button 
                    className="fixed bottom-6 right-6 z-50 p-6 text-xl font-extrabold shadow-lg transition-all duration-300 hover:scale-[1.02]"
                    onClick={() => setIsDrawerOpen(true)}
                    data-testid="button-open-compare"
                >
                    <Scale className="w-6 h-6 mr-3" />
                    Compare ({favorites.length})
                </Button>
            )}
            
            {/* Task #12: The Drawer Component */}
            <CompareDrawer 
                isOpen={isDrawerOpen} 
                onClose={() => setIsDrawerOpen(false)} 
            />
        </div>
    );
}
Step 2B: Add Logic to Neighborhood Page (client/src/pages/Neighborhood.tsx)
You should also include the fixed button on the Neighborhood detail page for continuity. You will need to wrap your Neighborhood component in a structure that can manage the CompareDrawer state (or move the button and drawer into the main App.tsx).

Simplest approach (for Neighborhood.tsx): We will only add the fixed button to the detail page, but note that the drawer itself would need to live in a shared parent component (like App.tsx) to truly work across pages. For this step, we'll focus on the button visibility:

TypeScript

// client/src/pages/Neighborhood.tsx (Updates)

// Imports
import { useFavorites } from '../hooks/useFavorites'; // ADD THIS IMPORT
import { Scale } from 'lucide-react'; 
import { Button } from '@/components/ui/button';

export default function Neighborhood() {
    // ... existing state/handlers ...
    const { favorites } = useFavorites(); // USE THE HOOK for count

    return (
        <div className="container py-8">
            {/* ... main content ... */}
            
            {/* Task #12: Fixed Compare Button */}
            {favorites.length > 0 && (
                <Button 
                    className="fixed bottom-6 right-6 z-50 p-6 text-xl font-extrabold shadow-lg transition-all duration-300 hover:scale-[1.02]"
                    // NOTE: This button needs to trigger the drawer, which would live in App.tsx. 
                    // For now, an alert confirms the feature.
                    onClick={() => alert("Compare Drawer is ready! It needs to be placed in your main App.tsx to appear on this page.")}
                    data-testid="button-open-compare"
                >
                    <Scale className="w-6 h-6 mr-3" />
                    Compare ({favorites.length})
                </Button>
            )}
        </div>
    );
}
Final Action:
Create the new file client/src/components/CompareDrawer.tsx with the code from Step 1.

Update client/src/pages/Home.tsx with the new state, useFavorites hook, fixed button, and the <CompareDrawer> component from Step 2A.

Update client/src/pages/Neighborhood.tsx with the fixed Compare button from Step 2B (including the necessary imports).

This completes the last major interactive task, Task #12!