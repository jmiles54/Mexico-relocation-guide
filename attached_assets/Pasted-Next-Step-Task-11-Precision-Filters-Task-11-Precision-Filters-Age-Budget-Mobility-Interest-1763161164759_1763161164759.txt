Next Step: Task #11 (Precision Filters)
Task #11: Precision Filters (Age, Budget, Mobility, Interests)

The goal of this task is to transform the portal from a simple information display into a personalized recommendation engine. Users will provide their preferences, and the LLM will use these inputs to recommend the best city.

Implementation Plan: Recommendation API
We will create a third and final specialized Groq LLM endpoint that accepts multiple user parameters and returns a personalized city recommendation with a justification.

Step 1: Implement the Backend Endpoint (server/routes.ts)
This endpoint will accept the key parameters we need for filtering: age, budget, mobility, and interests.

TypeScript

// server/routes.ts (ADD THIS ROUTE)

// Precision Filters / Recommendation Engine API endpoint (Task #11)
app.post('/api/recommendation', async (req, res) => {
    try {
        // Collect all user preferences from the request body
        const { age, budget, mobility, interests } = req.body;

        if (!age || !budget || !mobility || !interests) {
            return res.status(400).json({ error: "Missing one or more required preference parameters." });
        }

        const apiKey = process.env.GROQ_API_KEY;
        if (!apiKey) {
            return res.status(503).json({ error: "Groq API key not found." });
        }

        // Initialize Groq client
        const groq = new Groq({ apiKey });

        // Construct a highly specific prompt to guide the LLM's decision
        const systemPrompt = (
            "You are an expert relocation specialist for Mexico. Your knowledge base includes Puerto Vallarta, MÃ©rida, San Miguel de Allende, and CancÃºn. " +
            "Based ONLY on the user's detailed profile, select the SINGLE BEST CITY for them. " +
            "Your output must be a JSON object with two fields: 'city' (The name of the recommended city) and 'justification' (A concise 3-sentence explanation of why it fits the profile)."
        );
        
        const userProfile = (
            `The user's profile is:\n` +
            `- Age: ${age} years old\n` +
            `- Monthly Budget: $${budget}\n` +
            `- Mobility: ${mobility} (e.g., uses a cane/walker, fully mobile)\n` +
            `- Interests: ${interests} (e.g., beaches, colonial history, food, nightlife)\n\n` +
            `Which of the four cities (Puerto Vallarta, MÃ©rida, San Miguel de Allende, CancÃºn) is the absolute best match?`
        );

        const completion = await groq.chat.completions.create({
            model: "llama-3.3-70b-versatile",
            messages: [
                { role: "system", content: systemPrompt },
                { role: "user", content: userProfile }
            ],
            response_format: { type: "json_object" }
        });

        const jsonResponseText = completion.choices[0].message.content?.trim() || "{}";
        const recommendationData = JSON.parse(jsonResponseText);

        return res.json(recommendationData);

    } catch (error: any) {
        console.error('Recommendation API Error:', error);
        return res.status(500).json({ error: 'AI recommendation service failed to process request.' });
    }
});
Step 2: Frontend UI and Logic (client/src/pages/Home.tsx)
We will place a clean modal or form on the Home page to collect these inputs and display the result prominently.

Step 2A: Create the Form Component (client/src/components/RecommendationForm.tsx)
This is a simplified component using standard React state to manage the form inputs.

TypeScript

// client/src/components/RecommendationForm.tsx (NEW FILE)
import { useState } from 'react';
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
import { ChevronRight, Zap } from 'lucide-react';

interface RecommendationFormProps {
    onRecommend: (data: { city: string; justification: string }) => void;
}

const RecommendationForm: React.FC<RecommendationFormProps> = ({ onRecommend }) => {
    const [age, setAge] = useState('65');
    const [budget, setBudget] = useState('2500'); // Monthly USD
    const [mobility, setMobility] = useState('Fully Mobile');
    const [interests, setInterests] = useState('Beach, Art, Food');
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState<string | null>(null);

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        setLoading(true);
        setError(null);
        
        try {
            const response = await fetch('/api/recommendation', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ age, budget, mobility, interests })
            });
            
            const data = await response.json();

            if (!response.ok || data.error) {
                throw new Error(data.error || 'Failed to get recommendation.');
            }
            
            // Pass the data back to the parent component (Home.tsx)
            onRecommend(data);

        } catch (err: any) {
            setError(err.message || 'Error connecting to recommendation engine.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <Card className="shadow-2xl border-primary/50">
            <CardHeader>
                <CardTitle className="text-2xl flex items-center gap-2 text-primary">
                    <Zap className="w-6 h-6" />
                    Find Your Perfect City (Task #11)
                </CardTitle>
            </CardHeader>
            <CardContent>
                <form onSubmit={handleSubmit} className="space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {/* Age Input */}
                        <div className="space-y-2">
                            <Label htmlFor="age">Your Age</Label>
                            <Input id="age" type="number" value={age} onChange={(e) => setAge(e.target.value)} required min={18} />
                        </div>
                        {/* Budget Input */}
                        <div className="space-y-2">
                            <Label htmlFor="budget">Monthly Budget (USD)</Label>
                            <Input id="budget" type="number" value={budget} onChange={(e) => setBudget(e.target.value)} required min={1000} />
                        </div>
                    </div>
                    
                    {/* Mobility Input (Simple Select/Text for now) */}
                    <div className="space-y-2">
                        <Label htmlFor="mobility">Mobility Needs</Label>
                        <Input id="mobility" type="text" value={mobility} onChange={(e) => setMobility(e.target.value)} placeholder="e.g., Fully Mobile, Uses Walker, Wheelchair" required />
                    </div>
                    
                    {/* Interests Input */}
                    <div className="space-y-2">
                        <Label htmlFor="interests">Key Interests</Label>
                        <Input id="interests" type="text" value={interests} onChange={(e) => setInterests(e.target.value)} placeholder="e.g., Nightlife, Colonial History, Beaches, Hiking" required />
                    </div>
                    
                    {error && <p className="text-sm text-destructive">{error}</p>}

                    <Button type="submit" className="w-full text-lg" disabled={loading}>
                        {loading ? (
                            'Analyzing ðŸ§ ...'
                        ) : (
                            <>
                                Get AI Recommendation <ChevronRight className="w-4 h-4 ml-2" />
                            </>
                        )}
                    </Button>
                </form>
            </CardContent>
        </Card>
    );
};

export default RecommendationForm;
Step 2B: Integrate into Home Page (client/src/pages/Home.tsx)
Place the form prominently at the top of your Home.tsx and manage the recommendation state.

TypeScript

// client/src/pages/Home.tsx

// Imports
import RecommendationForm from '../components/RecommendationForm'; // ADD THIS IMPORT
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card"; // Ensure Card components are imported

// Inside Home Component:
export default function Home() {
    // ... existing state ...
    const [recommendation, setRecommendation] = useState<{ city: string; justification: string } | null>(null); // NEW

    // Handler to receive data from the form
    const handleRecommendation = (data: { city: string; justification: string }) => {
        setRecommendation(data);
        // Optional: Scroll to the result
        document.getElementById('recommendation-result')?.scrollIntoView({ behavior: 'smooth' });
    };

    return (
        <div className="container py-12">
            
            {/* Recommendation Form & Result Section (Task #11 UI) */}
            <div className="mb-12 grid grid-cols-1 lg:grid-cols-2 gap-8" id="recommendation-result">
                {/* Column 1: The Input Form */}
                <RecommendationForm onRecommend={handleRecommendation} />

                {/* Column 2: The Result Display */}
                <Card className={`shadow-2xl border-4 ${recommendation ? 'border-green-500/80' : 'border-border/50'} transition-all duration-500`}>
                    <CardHeader>
                        <CardTitle className="text-2xl text-foreground">
                            {recommendation ? `âœ… Recommended City:` : 'Your Personalized Match'}
                        </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                        {recommendation ? (
                            <div className="space-y-4">
                                <p className="text-6xl font-extrabold text-green-400">
                                    {recommendation.city}
                                </p>
                                <p className="text-lg text-muted-foreground italic">
                                    "{recommendation.justification}"
                                </p>
                            </div>
                        ) : (
                            <p className="text-muted-foreground py-16 text-center">
                                Enter your details to get an instant, AI-powered match from our four featured cities.
                            </p>
                        )}
                    </CardContent>
                </Card>
            </div>
            
            {/* ... rest of your Home page content (Hero, Neighborhoods, etc.) ... */}
        </div>
    );
}
Final Action
Add the new /api/recommendation route to your Node.js server (server/routes.ts).

Create the new file client/src/components/RecommendationForm.tsx.

Update client/src/pages/Home.tsx to import the new component and integrate the recommendation section at the top.

This completes the transformation into a personalization engine!